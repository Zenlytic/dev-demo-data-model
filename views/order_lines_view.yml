version: 1
type: view
name: order_lines
description: Description of order_lines view.
model_name: pure_organics
sql_table_name: DEMO_PROD.ORDER_LINES
default_date: order
row_label: Order line
identifiers:
- name: product_id
  type: foreign
  sql: ${product_id}
- name: customer_id
  type: foreign
  sql: ${customer_id}
fields:
- name: order_line_id
  field_type: dimension
  type: string
  hidden: true
  primary_key: true
  sql: ${TABLE}.ORDER_LINE_ID
  searchable: false

- name: customer_id
  field_type: dimension
  type: string
  hidden: true
  description: Represents the id of each customer
  drill_fields:
  - customers.email
  - customers.state
  - customers.city
  - customers.zipcode
  sql: ${TABLE}.CUSTOMER_ID
  tags:
  - customer
  searchable: false

- name: order_id
  field_type: dimension
  type: string
  hidden: false
  drill_fields:
  - order_date
  - subscription_vs_otp
  - marketing_channel
  - campaign
  - promotion
  - total_gross_revenue
  sql: ${TABLE}.ORDER_ID
  tags:
  - order
  searchable: false

- name: product_id
  field_type: dimension
  type: string
  hidden: true
  sql: ${TABLE}.PRODUCT_ID
  searchable: false

- name: discount
  field_type: dimension
  type: number
  hidden: true
  sql: ${TABLE}.DISCOUNT

- name: revenue
  field_type: dimension
  type: number
  hidden: true
  sql: ${TABLE}.REVENUE

- name: price
  field_type: dimension
  type: number
  hidden: true
  sql: ${TABLE}.PRICE

- name: quantity
  field_type: dimension
  type: number
  hidden: true
  sql: ${TABLE}.QUANTITY

- name: campaign
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  description: >-
    The marketing campaign that the customer came through before placing their
    order. hi
  tiers:
  sql: ${TABLE}.CAMPAIGN
  searchable: true
  synonyms: []

- name: promotion
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  description: The promotion given to the customer for this order.
  tiers:
  sql: ${TABLE}.PROMOTION
  searchable: true
  synonyms: []

- name: subscription_vs_otp
  field_type: dimension
  type: string
  hidden: false
  description: Whether the order was from a subscription or a one time purchase (OTP)
  sql: ${TABLE}.SUBSCRIPTION_VS_OTP
  searchable: true

- name: marketing_source
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  description: >-
    The marketing source that the customer came through before placing their
    order.
  tiers:
  sql: ${TABLE}.MARKETING_SOURCE
  searchable: true
  synonyms: []

- name: marketing_channel
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  description: >-
    The marketing channel that the customer came through before placing their
    order. hihi
  tiers:
  sql: ${TABLE}.MARKETING_CHANNEL
  searchable: true
  synonyms: []

- name: last_click_marketing_channel
  field_type: dimension
  type: string
  hidden: false
  description: >-
    The last click marketing channel that the customer came through before
    placing their order.
  sql: ${TABLE}.last_click
  searchable: true

- name: first_click_marketing_channel
  field_type: dimension
  type: string
  hidden: false
  description: >-
    The first click marketing channel that the customer came through before
    placing their order.
  sql: ${TABLE}.first_click
  searchable: true

- name: new_vs_repeat
  field_type: dimension
  type: string
  hidden: false
  primary_key: false
  description: >-
    Whether the customer placing the order was a new customer or a returning
    customer.
  tiers:
  sql: ${TABLE}.new_vs_repeat
  searchable: true
  synonyms: []

- name: associate_name_uijpypzq
  field_type: dimension
  type: string
  label: Associate Name
  sql: CASE WHEN ${order_lines.marketing_source} = 'google' THEN 'Amélie Dubois' WHEN
    ${order_lines.marketing_source} = 'facebook' THEN 'Camille Laurent' WHEN ${order_lines.marketing_source}
    = 'instagram' THEN 'Sophie Martin' WHEN ${order_lines.marketing_source} = 'klaviyo'
    THEN 'Marie Rousseau' WHEN ${order_lines.marketing_source} = 'tiktok' THEN 'Élise
    Bernard' ELSE 'Boutique Team' END
  canon_date: order_lines.order

- name: client_notes_ifwzsaqd
  field_type: dimension
  type: string
  label: Client Notes
  sql: CASE WHEN NOT ${order_lines.promotion} IS NULL AND ${order_lines.new_vs_repeat}
    = 'Repeat' THEN 'Loyal client with promotion preferences' WHEN ${order_lines.new_vs_repeat}
    = 'Repeat' THEN 'Regular returning client' WHEN ${order_lines.marketing_channel}
    = 'Organic' THEN 'Word-of-mouth referral' ELSE 'New client acquisition' END
  canon_date: order_lines.order

- name: last_visit_recency_retrvwdf
  field_type: dimension
  type: string
  label: Last Visit Recency
  sql: CASE WHEN DATE_TRUNC('MONTH', ${order_lines.order_raw}) = '2025-07-01' THEN
    'This Month' WHEN DATE_TRUNC('MONTH', ${order_lines.order_raw}) = '2025-06-01'
    THEN 'Last Month' WHEN DATE_TRUNC('MONTH', ${order_lines.order_raw}) >= '2025-05-01'
    THEN 'Recent (2 months)' ELSE 'Inactive' END
  canon_date: order_lines.order

- name: client_tier_wkpcyfqs
  field_type: dimension
  type: string
  label: Client Tier
  sql: CASE WHEN ${order_lines.promotion} IN ('REFERRAL30', 'FB_REPEAT15') THEN 'VIP
    Client' WHEN ${order_lines.promotion} IN ('EMAIL15', 'FB20') THEN 'Preferred Client'
    ELSE 'New Client' END
  canon_date: order_lines.order

- name: appointment_type_nhemkzoo
  field_type: dimension
  type: string
  label: Appointment Type
  sql: CASE WHEN ${order_lines.subscription_vs_otp} = 'Subscription' THEN 'Recurring
    Client Program' ELSE 'Walk-in Consultation' END
  canon_date: order_lines.order

- name: vip_tier_pcqvqwqu
  field_type: dimension
  type: string
  label: Vip Tier
  sql: CASE WHEN ${order_lines.revenue} >= 600 THEN 'Platinum VIP' WHEN ${order_lines.revenue}
    >= 450 THEN 'Gold VIP' WHEN ${order_lines.revenue} >= 300 THEN 'Silver VIP' ELSE
    'Standard Client' END
  canon_date: order_lines.order

- name: order
  field_type: dimension_group
  type: time
  datatype: timestamp
  hidden: false
  label: Order Date
  description: >-
    The time at which the order was placed. This is the main time field to use
    for orders
  timeframes:
  - raw
  - date
  - week_index
  - week
  - month_of_year
  - month
  - quarter
  - year
  - hour_of_day
  - day_of_week
  sql: ${TABLE}.ORDER_AT

- name: total_gross_revenue
  field_type: measure
  type: sum
  hidden: false
  label: Total Gross Revenue
  description: Total gross revenue = revenue from product sales + shipping revenues.
  value_format_name: usd
  sql: ${revenue}
  synonyms:
  - sales
  - revenue














- name: total_gross_revenue_from_advertising
  field_type: measure
  type: sum
  hidden: true
  description: Total gross revenue = revenue from product sales + shipping revenues
  value_format_name: usd
  sql: ${revenue}
  filters:
  - field: marketing_channel
    value: -Organic
  synonyms:
  - sales
  - revenue














- name: total_discounts
  field_type: measure
  type: sum
  hidden: false
  description: All discounts applied to either the order or the product in the order.
  value_format_name: usd
  sql: ${discount}
  synonyms: []

- name: total_net_revenue
  field_type: measure
  type: number
  hidden: false
  description: Total net revenue = gross revenue - discounts.
  value_format_name: usd
  sql: ${total_gross_revenue} - ${total_discounts}
  synonyms: []

- name: subscription_revenue
  field_type: measure
  type: sum
  hidden: false
  description: >-
    Subscription revenue = gross revenue (product revenues + shipping,for
    subscriptions only)
  value_format_name: usd
  sql: ${revenue}
  filters:
  - field: subscription_vs_otp
    value: Subscription














- name: number_of_customers_with_orders
  field_type: measure
  type: count_distinct
  hidden: false
  description: The unique number of customers who placed orders
  value_format_name: decimal_0
  sql: ${customer_id}

- name: number_of_new_customers_with_orders
  field_type: measure
  type: count_distinct
  hidden: false
  description: The unique number of new customers who placed orders
  value_format_name: decimal_0
  sql: ${customer_id}
  filters:
  - field: new_vs_repeat
    value: New














- name: number_of_orders
  field_type: measure
  type: count_distinct
  hidden: false
  description: The unique number of orders placed
  value_format_name: decimal_0
  sql: ${order_id}

- name: number_of_repeat_orders
  field_type: measure
  type: count_distinct
  hidden: false
  description: >-
    The unique number of orders placed by customers who have placed at least
    one order before
  value_format_name: decimal_0
  sql: ${order_id}
  filters:
  - field: new_vs_repeat
    value: Repeat














- name: repurchase_rate
  field_type: measure
  type: number
  hidden: false
  description: Repurchase rate = number of repeat orders / number of orders.
  value_format_name: percent_1
  sql: ${number_of_repeat_orders} / ${number_of_orders}
  synonyms:
  - Repeat order rate














- name: gross_aov
  field_type: measure
  type: number
  hidden: false
  description: Gross AOV = gross revenues / number of orders
  value_format_name: usd
  sql: ${total_gross_revenue} / nullif(${number_of_orders}, 0)
  synonyms:
  - Average order value













- name: number_of_units
  field_type: measure
  type: sum
  hidden: false
  label: Number Of Units
  description: >-
    The unique number of units purchased (e.g. customer orders: 2 lip gloss
    and 1 blush = 3 units sold)
  value_format_name: decimal_0
  sql: ${quantity}

- name: total_cogs
  field_type: measure
  type: sum
  hidden: false
  label: Total COGS
  description: The allocated cost of goods sold to the order line
  value_format_name: usd
  sql: ${TABLE}.cogs

- name: gross_profit
  field_type: measure
  type: number
  hidden: false
  description: The total net revenue - allocated cost of goods sold to the order line
  value_format_name: usd
  sql: ${total_net_revenue} - ${total_cogs}
  zoe_description: This is the gross profit.

- name: conversion_rate_llmafbob
  field_type: measure
  type: number
  label: Conversion Rate
  sql: COUNT(DISTINCT CASE WHEN ${order_lines.quantity} > 1 THEN ${order_lines.order_id}
    END) / NULLIF(COUNT(DISTINCT ${order_lines.order_id}), 0)
  canon_date: order_lines.order

- name: avg_products_per_service_fukemeol
  field_type: measure
  type: number
  label: Avg Products Per Service
  sql: SUM(${order_lines.quantity}) / NULLIF(COUNT(DISTINCT ${order_lines.order_id}),
    0)
  canon_date: order_lines.order
event_name: Purchase
fields_for_analysis:
- subscription_vs_otp
- marketing_source
- marketing_channel
- promotion
- campaign
- products.product_title
